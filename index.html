<html>
 <head>
   <title>Resource Computation</title>
   <style>
   html {
     font-family: sans-serif;
   }
   div.resource_group {
      border: 1px solid black;
      background-color: rgba( 0, 0, 0, 0.1 );
      padding-left: 10px;
      padding-bottom: 5px;
   }
   div.transmutation {
      background: linear-gradient(to bottom,rgba(255,255,0,0.5) 0%, rgba(0,0,0,0.1) 20%, rgba(0,0,0,0.1) 80% , rgba(0,0,0,0.1) 0%);
   }
   div.hidden {
     display: none;
   }
   span.resoname {
      font-weight: bold;
      padding-left: 10px;
      padding-right: 10px;
      border-right: 1px solid red;
      margin-right: 10px;
   }
   label {
     margin-left: 5px;
   }
   label.have_label, input.have_amt {
     color: black;
     font-style: italic;
     padding: 1px 5px;
     margin: 3px 5px;
     border: 1px cornflowerblue solid;
   }
   label.have_label {
     background-color: rgb( 200, 200, 200 );
     border-right: none;
     margin-right: 0;
   }
   input.have_amt {
     border-left: none;
     margin-left: 0;
     padding: 2px;
   }

   input.invalid {
     border: 1px solid #f00;
   }
  option.rlevel1, option.rlevel2, option.rlevel3, option.rlevel4,
  option.rlevel5, option.rlevel6, option.rlevel7, option.rlevel8 {
    background-color: #fff;
    font-weight: bold;
  }
  span.resoname,  strong.rlevel1, strong.rlevel2, strong.rlevel3,
  strong.rlevel4, strong.rlevel5, strong.rlevel6, strong.rlevel7, strong.rlevel8 {  color: #fff }

  option.rlevel1 {   color: #444a50;   }
  .rlevel1 > span.resoname, strong.rlevel1 {   background-color: #444a50 }

  option.rlevel2 { color: #7c6758 }
  .rlevel2 > span.resoname, strong.rlevel2 {   background-color: #7c6758;  }

  option.rlevel3 { color: #4c623c }
  .rlevel3 > span.resoname, strong.rlevel3 {  background-color: #4c623c;  }

  option.rlevel4 { color: #4c6f84;  }
  .rlevel4 > span.resoname, strong.rlevel4 { background-color: #4c6f84;  }

  option.rlevel5 { color: #833a34;  }
  .rlevel5 > span.resoname, strong.rlevel5 { background-color: #833a34;  }

  option.rlevel6 { color: #d47e3b;  }
  .rlevel6 > span.resoname, strong.rlevel6 { background-color: #d47e3b;  }

  option.rlevel7 { color: #d3b654; }
  .rlevel7 > span.resoname, strong.rlevel7 { background-color: #d3b654;  }


  option.rlevel8 {
    background-color: #000;
    color: #e9e9e9;
  }

  div.rlevel8 > span.resoname, strong.rlevel8 {
    color: #000;
    background-color: #e9e9e9;
  }

  div#halp {
    max-width: 500px;
    margin: 0px auto;
  }
  #halp p {
    font-size: 14px;
  }
  li.resource_group {
    background-color: rgba( 0, 0, 0, 0.1 );
    padding: 2px;
    display: inline-block;
    margin-right: 5px;
    margin-bottom: 3px;
  }

  </style>
 <script>
/* included from js/ArrayUtils.js  */
window.ArrayUtils = (function() {

  let utils  = {};

  utils.unique = function(array) {
      return Object.keys(array.reduce(function(acc,elem) {
          acc[elem] = true;
          return acc;
      },{}));
  };

  utils.extend = function(array_orig) {
    for ( let i = 1; i < arguments.length; i++ ) Array.prototype.push.apply( array_orig, arguments[i] );
    return array_orig;
  }

  return utils;
})();

/* included from js/AlbionItemAttributes.js  */
window.AlbionItemAttributes = (function() {

  let fns = {};

  /* Note: identity records exist for case-folding
   *       and pass-through */
  let name_coercion_map = {
    "t"             : "tier",
    "teir"          : "tier",
    "tier"          : "tier",
    "transmute_from": "transmute_from",
    "transmute-from": "transmute_from"
  };

  fns.coerce_attribute_name = function( name ) {
    let lc = name.toLowerCase();
    return lc in name_coercion_map
      ? name_coercion_map[lc]
      : name;
  };

  fns.validate_attribute_name = function( name ) {
    if ( name in name_coercion_map ) return true;
    throw "Invalid attribute name: '" + name + "'";
  };

  let value_coercion_map = { }; /* todo */

  let value_validation_map = {
    tier: function( name, value ) {
      if ( value < 1 ) throw "Invalid tier '" + value + "', smaller than 1";
      if ( value > 8 ) throw "Invalid tier '" + value + "', greater than 8";
    },
    transmute_from: function( name, value ) {
      return true;
    },
  };

  fns.coerce_value = function( name, value ) {
    return name in value_coercion_map
      ? value_coercion_map[name](value)
      : value;
  };

  fns.validate_value = function( name, value ) {
    if ( name in value_validation_map ) return value_validation_map[name](name, value);
    throw "Invalid attribute name: '" + name + "'";
  };

  return fns;
})();

/* included from js/AlbionItem.js  */
window.AlbionItem = (function(ArrayUtils) {

  function AlbionItem(  name, resources, attributes ) {
    this.name       = name;
    this.resources  = resources  || {};
    this.attributes = attributes || {};
  };

  AlbionItem.prototype.has_tier = function() {
    return this.attributes.hasOwnProperty('tier');
  };

  AlbionItem.prototype.tier = function() {
    return this.attributes.hasOwnProperty('tier')
      ? this.attributes.tier
      : 1;
  };

  AlbionItem.prototype.is_tier = function ( tier ) {
    return this.attributes.hasOwnProperty('tier')
      && this.attributes.tier == tier;
  };

  AlbionItem.prototype.has_attribute = function( attrname ) {
    return this.attributes.hasOwnProperty( attrname );
  };

  AlbionItem.prototype.get_attribute = function( attrname ) {
    return this.attributes.hasOwnProperty(attrname)
      ? this.attributes[attrname]
      : undefined;
  };

/* "Required" resources only apply to non-transmutation requirements */
  AlbionItem.prototype.crafting_resource_names = function() {
    let out = [];
    for ( let needed_resource in this.resources ) {
      if ( this.resources.hasOwnProperty(needed_resource) ) {
        out.push( needed_resource );
      }
    }
    out.sort();
    return out;
  };

  AlbionItem.prototype.crafting_requires = function (resource) {
    return this.resources.hasOwnProperty( resource );
  };

  AlbionItem.prototype.get_crafting_cost = function (resource) {
    return this.resources.hasOwnProperty( resource )
      ? this.resources[resource]
      : 0;
  };

  AlbionItem.prototype.transmuting_resource_names = function() {
    let out = [];
    if ( this.attributes.hasOwnProperty('transmute_from') ) {
      for ( let needed_resource in this.attributes.transmute_from ) {
        if ( this.attributes.transmute_from.hasOwnProperty(needed_resource) ) {
          out.push( needed_resource );
        }
      }
    }
    out.sort();
    return out;
  };

  AlbionItem.prototype.transmutable = function() {
    return this.attributes.hasOwnProperty('transmute_from');
  };
  AlbionItem.prototype.transmuting_requires = function (resource) {
    return this.attributes.hasOwnProperty('transmute_from')
      && this.attributes.transmute_from.hasOwnProperty(resource);
  };
  AlbionItem.prototype.get_transmuting_cost = function (resource) {
    return this.attributes.hasOwnProperty('transmute_from')
      && this.attributes.transmute_from.hasOwnProperty(resource)
      ? this.attributes.transmute_from[resource]
      : 0;
  };

  AlbionItem.prototype.all_resource_names = function() {
    return ArrayUtils.unique( ArrayUtils.extend( [], this.crafting_resource_names(), this.transmuting_resource_names() ) );
  }

  AlbionItem.prototype.get_cost = function (resource) {
    return this.resources.hasOwnProperty(resource)
      ? this.resources[resource]
      : this.attributes.hasOwnProperty('transmute_from') && this.attributes.transmute_from.hasOwnProperty(resource)
      ? this.attributes.transmute_from[resource]
      : 0;
  }

  return AlbionItem;
})(ArrayUtils);

/* included from js/AlbionData.js  */
(function() {
  var AlbionData = {
    items:      {},
    item_names: [],
    log_items:  [],
    keep_logs:  false,
    print_logs: false
  };
  document.AlbionData = AlbionData;

  let legal_attributes = {
    tier: function(value) {
      if ( 1 > value  ) {
        throw "Invalid tier: " + value + " < 1";
      }
      if (value > 8 ) {
        throw "Invalid tier: " + value + " > 8";
      }
    },
    transmute_from: function( resource_map ) {
      for ( let key in resource_map ) {
        if ( !resource_map.hasOwnProperty(key) ) {
          continue;
        }
        if( typeof AlbionData.items[key] == "undefined" ) {
          throw "Resource " + key + " not already defined";
        }
      }
    },
    keywords: function( array ) {
      return true;
    }
  };

  AlbionData.item_names_copy = function() {
    let out = [];
    Array.prototype.push.apply(out, AlbionData.item_names);
    return out;
  };

  AlbionData.filter_itemlist = function( itemlist, callback ) {
    let out = [];
    for ( let item of itemlist ) {
      let itemdata = AlbionData.get_resource(item);
      if ( callback(itemdata, item) ) {
        out.push(item);
      }
    }
    return out;
  }

  AlbionData.filter_tier = function( itemlist, tier ) {
    return AlbionData.filter_itemlist( itemlist, function(item) {
      return item.has_tier && item.tier == tier;
    });
  }
  AlbionData.filter_keyword = function( itemlist, keyword ) {
    let sterm = keyword.toLowerCase();
    return AlbionData.filter_itemlist( itemlist, function(item, name) {
      if ( name.toLowerCase().indexOf(sterm) > -1 ) {
        return true;
      }
      if ( item.has_keywords ) {
        for ( let keyword of item.keywords ) {
          if ( keyword.indexOf(sterm) > -1 ) {
            return true;
          }
        }
      }
      return false;
    });
  }

  AlbionData.add_item = function( name, resources, attributes ) {
    if( typeof AlbionData.items[name] != "undefined" ) {
      throw "Field: " + name + " already defined";
    }
    if ( typeof resources == "undefined" ) {
      resources = {};
    }
    if ( typeof attributes == "undefined" ) {
      attributes = {};
    }

    let resource = {
      resources: {},
      attributes: {},
    };

    for ( let key in resources ) {
      if ( !resources.hasOwnProperty(key) ) {
        continue;
      }
      if( typeof AlbionData.items[key] == "undefined" ) {
        throw "Field: " + key + " of " + name + " not already defined";
      }
      resource.resources[key] = resources[key];
    }
    for ( let key in attributes ) {
      if ( !attributes.hasOwnProperty(key) ) {
        continue;
      }
      if( typeof legal_attributes[key] == "undefined" ) {
        throw "Attribute: " + key + " of " + name + " not legal";
      }
      legal_attributes[key]( attributes[key] );
      resource.attributes[key] = attributes[key];
    }
    AlbionData.items[name] = resource;
    AlbionData.item_names.push(name);
  };
  AlbionData.get_resources = function( name ) {
    if ( typeof AlbionData.items[name] == "undefined" ) {
      throw "Can't get costs for: " + resource;
    }
    return AlbionData.items[name].resources;
  };
  AlbionData.get_resource = function( name ) {
    if ( typeof AlbionData.items[name] == "undefined" ) {
      throw "No such resource: " + resource;
    }
    let data_internal = AlbionData.items[name];
    let data = {
      resources: data_internal.resources,
      attributes: data_internal.attributes
    };

    data.has_tier   = ( typeof data.attributes['tier'] != "undefined" );

    if ( data.has_tier ) {
      data.tier = data.attributes["tier"];
    }
    data.is_tier    = function( tier ) {
      if ( data.has_tier ) { return data.tier == tier }
      return false;
    };
    data.resource_names = [];
    for ( let needed_resource in data.resources ) {
      if ( data.resources.hasOwnProperty(needed_resource) ) {
         data.resource_names.push(needed_resource);
      }
    }
    data.resource_names.sort();
    data.resources_needed = function( name, amt ) {
      if ( data.can_transmute && typeof data.transmute_from[name] != "undefined" ) {
        return data.transmute_from[name] * amt;
      }
      return data.resources[name] * amt;
    };

    data.can_transmute = false;
    if ( typeof data.attributes['transmute_from'] != "undefined" ) {
      data.can_transmute = true;
      data.transmute_from_names = [];
      for ( let needed_resource in data.attributes['transmute_from'] ) {
        if ( data.attributes['transmute_from'].hasOwnProperty(needed_resource) ) {
         data.transmute_from_names.push(needed_resource);
        }
      }
      data.transmute_from = data.attributes['transmute_from'];
    }
    data.has_keywords = false;
    if ( typeof data.attributes['keywords'] != "undefined" ) {
      data.has_keywords = true;
      data.keywords = [];
      for ( let keyword of data.attributes['keywords'] ) {
        data.keywords.push( keyword.toLowerCase() );
      }
      data.keywords.sort();
    }
    return data;
  };
  AlbionData.log = function() {
    if( AlbionData.print_logs ) {
      return console.log.apply(console, arguments);
    }
    if ( AlbionData.keep_logs ) {
      AlbionData.log_items.push(arguments);
    }
  };
  AlbionData.print_log = function() {
    if ( !AlbionData.keep_logs ) {
      return;
    }
    for ( let row of AlbionData.log_items ) {
      console.log.apply(console, row);
    }
  };
})();

/* included from jsd/items.js  */
(function() {
  let add_item = document.AlbionData.add_item;
/* Core Materials */
  add_item("Silver");

  /* T1 Materials */
  add_item( "Rough Logs"  ,   {}, { tier: 1 });
  add_item( "Rough Stone" ,   {}, { tier: 1 });
  add_item( "Scraps of Hide", {}, { tier: 1 });

  /* T2 Materials */
  add_item( "Copper Ore"  , {}, { tier: 2 } );
  add_item( "Cotton"      , {}, { tier: 2, keywords: ['fibre'] } );
  add_item( "Rugged Hide" , {}, { tier: 2 } );
  add_item( "Limestone"   , {}, { tier: 2 } );
  add_item( "Birch Logs"  , {}, { tier: 2 } );

  /* T3 Materials */
  add_item( "Sandstone"      , { }, { tier: 3, transmute_from: { "Limestone":   3 } });
  add_item( "Chestnut Logs"  , { }, { tier: 3, transmute_from: { "Birch Logs":  3 } });
  add_item( "Thin Hide"      , { }, { tier: 3, transmute_from: { "Rugged Hide": 3 } });
  add_item( "Tin Ore"        , { }, { tier: 3, transmute_from: { "Copper Ore":  3 } });
  add_item( "Flax"           , { }, { tier: 3, transmute_from: { "Cotton":      3 }, keywords: ['fibre'] });

  /* T4 Materials */
  add_item( "Travertine"    , { }, { tier: 4, transmute_from: { "Sandstone": 6     }, keywords: ['stone'] });
  add_item( "Medium Hide"   , { }, { tier: 4, transmute_from: { "Thin Hide": 6     } });
  add_item( "Iron Ore"      , { }, { tier: 4, transmute_from: { "Tin Ore": 6       } });
  add_item( "Pine Logs"     , { }, { tier: 4, transmute_from: { "Chestnut Logs": 6 } });
  add_item( "Hemp"          , { }, { tier: 4, transmute_from: { "Flax": 6          }, keywords: ['fibre'] });

  add_item( "Uncommon Medium Hide",     { }, { tier: 4, transmute_from: { "Medium Hide" :          1, "Silver": 6000   } });
  add_item( "Rare Medium Hide",         { }, { tier: 4, transmute_from: { "Uncommon Medium Hide" : 1, "Silver": 12000  } });
  add_item( "Exceptional Medium Hide",  { }, { tier: 4, transmute_from: { "Rare Medium Hide" :     1, "Silver": 24000  } });

  add_item( "Uncommon Iron Ore",        { }, { tier: 4, transmute_from: { "Iron Ore" :              1, "Silver": 6000  } });
  add_item( "Rare Iron Ore",            { }, { tier: 4, transmute_from: { "Uncommon Iron Ore" :     1, "Silver": 12000 } });
  add_item( "Exceptional Iron Ore",     { }, { tier: 4, transmute_from: { "Rare Iron Ore" :         1, "Silver": 24000 } });

  /* T5 Materials */
  add_item( "Cedar Logs",   { }, { tier: 5, transmute_from: { "Pine Logs"  : 9 }});
  add_item( "Granite",      { }, { tier: 5, transmute_from: { "Travertine" : 9 }, keywords: ['stone'] });
  add_item( "Titanium Ore", { }, { tier: 5, transmute_from: { "Iron Ore"   : 9 }});
  add_item( "Heavy Hide",   { }, { tier: 5, transmute_from: { "Medium Hide" : 9}});
  add_item( "Skyflower",    { }, { tier: 5, transmute_from: { "Hemp": 9        }, keywords: ['fibre'] });

  /* T6 Materials */
  add_item( "Bloodoak Logs" , { }, { tier: 6, transmute_from: { "Cedar Logs"   : 15 }});
  add_item( "Slate",          { }, { tier: 6, transmute_from: { "Granite"      : 15 }, keywords: ['stone'] });
  add_item( "Runite Ore"    , { }, { tier: 6, transmute_from: { "Titanium Ore" : 15 }});
  add_item( "Robust Hide",    { }, { tier: 6, transmute_from: { "Heavy Hide"   : 15 }});
  add_item( "Readleaf Cotton",{ }, { tier: 6, transmute_from: { "Skyflower"    : 15 }, keywords: ['fibre'] });

  /* T7 Materials */
  add_item( "Ashenbark Logs", { }, { tier: 7, transmute_from: { "Bloodoak Logs"  : 25 }});
  add_item( "Basalt"        , { }, { tier: 7, transmute_from: { "Slate"          : 25 }, keywords: ['stone'] });
  add_item( "Meteorite Ore" , { }, { tier: 7, transmute_from: { "Runite Ore"     : 25 }});
  add_item( "Thick Hide",     { }, { tier: 7, transmute_from: { "Robust Hide"    : 25 }});
  add_item( "Sunflax",        { }, { tier: 7, transmute_from: { "Readleaf Cotton": 25 }, keywords: ['fibre'] });

  /* T8 Materials */
  add_item( "Marble"        , { }, { tier: 8, transmute_from: { "Basalt"        : 42 }, keywords: ['stone'] });
  add_item( "Resilient Hide", { }, { tier: 8, transmute_from: { "Thick Hide"    : 42 }});
  add_item( "Whitewood Logs", { }, { tier: 8, transmute_from: { "Ashenbark Logs": 42 }});
  add_item( "Ghost Hemp",     { }, { tier: 8, transmute_from: { "Sunflax":        42 }, keywords: ['fibre'] });
  add_item( "Adamantium Ore", { }, { tier: 8, transmute_from: { "Meteorite Ore":  42 }});

/* Crops */
  /* T2 Crops */
  add_item("Arcane Agaric" , {}, {tier: 2, keywords: ['crop']});
  add_item("Carrots", {}, { tier: 2, keywords: ['crop']});
  add_item("Beans", {}, {tier: 2, keywords: ['crop'] });

/* Drops / Uniques */
  add_item( "Explorers Anchor" , {}, { tier: 3 });

/* Crafted Materials */
  /* T2 Materials */
  add_item( "Birch Planks" ,   { "Birch Logs":   1 }, { tier: 2 });
  add_item( "Copper Bar",      { "Copper Ore":   1 }, { tier: 2 });
  add_item( "Simple Cloth",    { "Cotton" :      1 }, { tier: 2 });
  add_item( "Stiff Leather",   { "Rugged Hide" : 1 }, { tier: 2 });
  add_item( "Limestone Block", { "Limestone"   : 1 }, { tier: 2 });

  /* T3 Materials */
  add_item( "Chestnut Planks", { "Chestnut Logs": 2, "Birch Planks":    1 }, { tier: 3 });
  add_item( "Sandstone Block", { "Sandstone" :    2, "Limestone Block": 1 }, { tier: 3 });
  add_item( "Thick Leather",   { "Thin Hide" :    2, "Stiff Leather":   1 }, { tier: 3 });
  add_item( "Bronze Bar",      { "Tin Ore"   :    2, "Copper Bar":      1 }, { tier: 3 });
  add_item( "Neat Cloth",      { "Flax"      :    2, "Simple Cloth":    1 }, { tier: 3 });

  /* T4 Materials */
  add_item( "Travertine Block", { "Travertine" : 2, "Sandstone Block" : 1 }, { tier: 4 });
  add_item( "Worked Leather",  { "Medium Hide" :  2, "Thick Leather":   1 }, { tier: 4 });
  add_item( "Steel Bar", { "Iron Ore": 2, "Bronze Bar" : 1 }, { tier: 4 });
  add_item( "Pine Planks", { "Pine Logs": 2, "Chestnut Planks": 1 }, { tier: 4 });
  add_item( "Fine Cloth", { "Hemp" : 2, "Neat Cloth": 1 }, { tier: 4 });

  add_item( "Uncommon Worked Leather", { "Uncommon Medium Hide" : 2, "Thick Leather" : 1 }, { tier: 4 });
  add_item( "Rare Worked Leather", { "Rare Medium Hide" : 2, "Thick Leather" : 1 }, { tier: 4 });
  add_item( "Exceptional Worked Leather", { "Exceptional Medium Hide" : 2, "Thick Leather" : 1 }, { tier: 4 });
  add_item( "Uncommon Steel Bar", { "Uncommon Iron Ore": 2, "Bronze Bar" : 1 }, { tier: 4});
  add_item( "Rare Steel Bar", { "Rare Iron Ore": 2, "Bronze Bar" : 1 }, {tier: 4 });
  add_item( "Exceptional Steel Bar", { "Exceptional Iron Ore": 2, "Bronze Bar" : 1 }, {tier: 4});

  /* T5 Materials */
  add_item( "Cedar Planks",  { "Cedar Logs": 3, "Pine Planks" : 1   }, {tier: 5});
  add_item( "Granite Block", { "Granite" : 3, "Travertine Block": 1 }, {tier: 5});
  add_item( "Titanium Steel Bar", { "Titanium Ore": 3, "Steel Bar": 1 }, {tier: 5});
  add_item( "Ornate Cloth", { "Skyflower": 3, "Fine Cloth": 1 }, { tier: 5 });
  add_item( "Cured Leather", { "Heavy Hide": 3, "Worked Leather": 1 }, { tier: 5 });

  /* T6 Materials */
  add_item( "Bloodoak Planks", { "Bloodoak Logs": 4, "Cedar Planks": 1  }, {tier: 6});
  add_item( "Slate Block",     { "Slate" : 4,        "Granite Block": 1 }, {tier: 6});
  add_item( "Runite Steel Bar", { "Runite Ore": 4,        "Titanium Steel Bar": 1 }, {tier: 6});
  add_item( "Lavish Cloth", { "Readleaf Cotton": 4, "Ornate Cloth": 1 }, { tier: 6 });
  add_item( "Hardened Leather", { "Robust Hide": 4, "Cured Leather": 1 }, { tier: 6 });

  /* T7 Materials */
  add_item( "Ashenbark Planks", { "Ashenbark Logs": 5, "Bloodoak Planks" : 1 }, {tier: 7});
  add_item( "Basalt Block",     { "Basalt":         5, "Slate Block"     : 1 }, {tier: 7});
  add_item( "Meteorite Steel Bar", { "Meteorite Ore": 5, "Runite Steel Bar": 1 }, {tier: 7});
  add_item( "Opulent Cloth", { "Sunflax": 5, "Lavish Cloth": 1 }, { tier: 7 });
  add_item( "Reinforced Leather", { "Thick Hide": 5, "Hardened Leather": 1 }, { tier: 7 });

  /* T8 Materials */
  add_item( "Marble Block",     { "Marble":         5, "Basalt Block"    : 1 }, {tier: 8});
  add_item( "Baroque Cloth",    { "Ghost Hemp":     5, "Opulent Cloth"   : 1 }, {tier: 8});
  add_item( "Fortified Leather",{ "Resilient Hide": 5, "Reinforced Leather": 1 }, {tier: 8});
  add_item( "Adamantium Steel Bar", { "Adamantium Ore": 5, "Meteorite Steel Bar": 1}, {tier: 8});
  add_item( "Whitewood Planks", { "Whitewood Logs": 5, "Ashenbark Planks":1 }, {tier: 8});

/* Toolmaker */
  /* Novices Toolmaker -> Tools */
  add_item( "Beginners Pickaxe",         { "Rough Stone":   3, "Rough Logs": 3 }, {tier: 1});
  add_item( "Beginners Axe",             { "Rough Stone":   3, "Rough Logs": 3 }, {tier: 1});
  add_item( "Beginners Skinning Kinfe",  { "Rough Stone":   3, "Rough Logs": 3 }, {tier: 1});
  add_item( "Beginners Sickle",          { "Rough Stone":   3, "Rough Logs": 3 }, {tier: 1});
  add_item( "Beginners Stone Hammer",    { "Rough Stone":   3, "Rough Logs": 3 }, {tier: 1});

  add_item( "Novices Sickle",            { "Birch Planks":  6, "Copper Bar": 2 }, {tier: 2});
  add_item( "Novices Pickaxe",           { "Birch Planks":  6, "Copper Bar": 2 }, {tier: 2});
  add_item( "Novices Skinning Kinfe",    { "Birch Planks":  6, "Copper Bar": 2 }, {tier: 2});
  add_item( "Novices Stone Hammer",      { "Birch Planks":  6, "Copper Bar": 2 }, {tier: 2});
  add_item( "Novices Demolition Hammer", { "Birch Planks": 12, "Copper Bar": 12}, {tier: 2});

  add_item( "Journeymans Sickle",            { "Chestnut Planks":  6, "Bronze Bar": 2 }, {tier: 3});
  add_item( "Journeymans Pickaxe",           { "Chestnut Planks":  6, "Bronze Bar": 2 }, {tier: 3});
  add_item( "Journeymans Skinning Kinfe",    { "Chestnut Planks":  6, "Bronze Bar": 2 }, {tier: 3});
  add_item( "Journeymans Stone Hammer",      { "Chestnut Planks":  6, "Bronze Bar": 2 }, {tier: 3});
  add_item( "Journeymans Demolition Hammer", { "Chestnut Planks":  8, "Bronze Bar": 8 }, {tier: 3});


  /* Novices Toolmaker -> Accessories */
  add_item( "Novices Bag",  { "Simple Cloth" : 12, "Stiff Leather" : 12 }, {tier: 2});
  add_item( "Novices Cape", { "Simple Cloth" :  4, "Stiff Leather" :  4 }, {tier: 2});

  add_item( "Journeymans Bag",  { "Neat Cloth" : 8, "Thick Leather" : 8 }, {tier: 3});
  add_item( "Journeymans Cape", { "Neat Cloth" : 4, "Thick Leather" : 4 }, {tier: 3});

  /* Novices Toolmaker -> Furniture */
  add_item( "Novices Chest", { "Birch Planks" : 20, "Copper Bar": 10 }, {tier: 2});
  add_item( "Novices Bed",   { "Birch Planks" : 10, "Copper Bar": 20 }, {tier: 2});
  add_item( "Novices Table", { "Birch Planks" : 30, "Copper Bar": 30 }, {tier: 2});

  add_item( "Journeymans Chest", { "Chestnut Planks" : 20, "Bronze Bar": 10 }, {tier: 3});
  add_item( "Journeymans Bed",   { "Chestnut Planks" : 10, "Bronze Bar": 20 }, {tier: 3});
  add_item( "Journeymans Table", { "Chestnut Planks" : 30, "Bronze Bar": 30 }, {tier: 3});


/* Warriors Forge */
  /* Novices Warriors Forge -> Weapons */
  add_item("Beginners Broadsword", { "Rough Stone"  :  6, "Rough Logs":    6 }, {tier: 1});
  add_item("Beginners Shield",     { "Rough Logs"   :  4                     }, {tier: 1});
  add_item("Novices Broadsword",   { "Copper Bar"   : 16, "Stiff Leather": 8 }, {tier: 2});
  add_item("Novices Sheild",       { "Birch Planks" :  4, "Copper Bar"   : 4 }, {tier: 2});

  /* Novices Warriors Forge -> Armor */
  add_item("Novices Soldier Helmet", { "Copper Bar" : 8  }, { tier: 2});
  add_item("Novices Soldier Armor",  { "Copper Bar" : 16 }, { tier: 2});
  add_item("Novices Soldier Boots",  { "Copper Bar" : 8  }, { tier: 2});

/* Hunters Lodge */
  /* Novices Weapons */
  add_item("Novices Bow", { "Birch Planks" : 32 }, { tier: 2 });
  /* Journeymans Weapons */
  add_item("Journeymans Bow", { "Chestnut Planks": 32}, { tier: 3 });
  add_item("Journeymans Spear", { "Chestnut Planks": 16, "Bronze Bar" : 8 }, { tier: 3 });
  add_item("Journeymans Nature Staff", { "Chestnut Planks": 16, "Neat Cloth" : 8 }, { tier: 3 });
  add_item("Journeymans Dagger", { "Bronze Bar": 12, "Thick Leather": 12 }, { tier: 3 });
  add_item("Journeymans Quarterstaff", { "Bronze Bar": 12, "Thick Leather": 20 }, { tier: 3 });
  add_item("Journeymans Torch", { "Chestnut Planks": 4, "Neat Cloth": 4 }, { tier: 3 });

  /* Armour */
  add_item("Beginners Mercenary Hood", { "Scraps of Hide": 4 }, { tier: 1 });
  add_item("Beginners Mercenary Jacket", { "Scraps of Hide": 8 }, { tier: 1 });
  add_item("Beginners Mercenary Shoes", { "Scraps of Hide": 6 }, { tier: 1 });

  add_item("Novices Mercenary Hood", { "Stiff Leather": 8 }, { tier: 2 });
  add_item("Novices Mercenary Jacket", { "Stiff Leather": 16 }, { tier: 2 });
  add_item("Novices Mercenary Shoes", { "Stiff Leather": 8 }, { tier: 2 });

  add_item("Journeymans Mercenary Hood", { "Stiff Leather": 8 }, { tier: 3 });
  add_item("Journeymans Mercenary Jacket", { "Stiff Leather": 16 }, { tier: 3 });
  add_item("Journeymans Mercenary Shoes", { "Stiff Leather": 8 }, { tier: 3 });

/* Alchemists Lab */
  /* Novices Alchemists Lab -> Potions */
  add_item("Minor Healing Potion", { "Arcane Agaric" : 8 }, {tier: 2});
  add_item("Minor Energy Potion", { "Arcane Agaric" : 8 }, {tier: 2});

/* Cook */
  /* Novices Cook -> Food */
  add_item("Carrot Soup", { "Carrots" : 16 }, { tier: 1 , keywords: ['food']});
  add_item("Bean Salad",  { "Beans"   :  8, "Carrots" : 8 }, { tier: 2 , keywords: ['food']});

/* Mage Tower */
  /* Novices Mage Tower -> Weapons */
  add_item("Novices Fire Staff",      { "Birch Planks" : 16, "Copper Bar":    8 }, { tier: 2 });
  add_item("Novices Tome of Spells",  { "Simple Cloth" :  4, "Stiff Leather": 4 }, { tier: 2 });

  add_item("Journeymans Arcane Staff", { "Chestnut Planks" : 16, "Bronze Bar": 8 }, { tier: 3});
  add_item("Journeymans Fire Staff", { "Chestnut Planks" : 16, "Bronze Bar": 8 }, { tier: 3});
  add_item("Journeymans Holy Staff", { "Chestnut Planks" : 16, "Bronze Bar": 8 }, { tier: 3});
  add_item("Journeymans Cursed Staff", { "Chestnut Planks" : 16, "Bronze Bar": 8 }, { tier: 3});
  add_item("Journeymans Frost Staff", { "Chestnut Planks" : 16, "Bronze Bar": 8 }, { tier: 3});
  add_item("Journeymans Tome of Spells", { "Neat Cloth" : 4, "Thick Leather": 4 }, { tier: 3});

  /* Novics Mage Tower -> Armor */
  add_item("Novices Scholar Cowl",    { "Simple Cloth" :  8 }, {tier: 2 });
  add_item("Novices Scholar Robe",    { "Simple Cloth" : 16 }, {tier: 2 });
  add_item("Novices Scholar Sandals", { "Simple Cloth" :  8 }, {tier: 2 });

  add_item("Journeymans Scholar Cowl", { "Neat Cloth": 8 }, {tier: 3});
  add_item("Journeymans Scholar Robe", { "Neat Cloth": 16 }, {tier: 3});
  add_item("Journeymans Scholar Sandals", { "Neat Cloth": 8 }, {tier: 3});

/* Building Costs */
  /* Player Buildings */
  add_item("Novices Guild Hall",  { "Rough Logs": 150, "Rough Stone": 15, "Limestone Block" : 900 }, {tier: 2});
  add_item("Novices House",       { "Rough Logs":  30, "Rough Stone":  3, "Limestone Block" : 180 }, {tier: 2});

  add_item("Legendary Explorers Shelter", { "Explorers Anchor" : 1,
                                            "Rough Logs":  30, "Rough Stone":  3, "Limestone Block" : 180 }, {tier: 2});


  add_item("Journeymans Guild Hall", { "Novices Guild Hall": 1, "Rough Logs": 300, "Rough Stone": 30, "Sandstone Block": 900}, { tier: 3 });
  add_item("Journeymans House", { "Novices House": 1, "Rough Logs": 60, "Rough Stone": 6, "Sandstone Block": 180}, { tier: 3 });
  add_item("Legendary Explorers Hut", { "Legendary Explorers Shelter": 1, "Rough Logs": 60, "Rough Stone": 6, "Sandstone Block": 180 }, { tier: 3 });

  add_item("Adepts Guild Hall", { "Journeymans Guild Hall": 1, "Rough Logs": 600, "Rough Stone": 60, "Travertine Block": 900 }, { tier: 4 });
  add_item("Adepts House" ,  { "Journeymans House": 1, "Rough Logs": 120, "Rough Stone": 12, "Travertine Block": 180 } , { tier: 4 });
  add_item("Legendary Explorers House", { "Legendary Explorers Hut" : 1, "Rough Logs": 120, "Rough Stone": 12, "Travertine Block": 180 }, { tier: 4 });

  add_item("Experts Guild Hall", { "Adepts Guild Hall": 1, "Rough Logs": 1200, "Rough Stone": 120, "Granite Block": 900 }, { tier: 5 });
  add_item("Experts House" ,  { "Adepts House": 1, "Rough Logs": 240, "Rough Stone": 24, "Granite Block": 180 } , { tier: 5 });
  add_item("Legendary Explorers Residence", { "Legendary Explorers House" : 1, "Rough Logs": 240, "Rough Stone": 24, "Granite Block": 180 }, { tier: 5 });

  add_item("Masters Guild Hall", { "Experts Guild Hall": 1, "Rough Logs": 2400, "Rough Stone": 240, "Slate Block": 900 }, { tier: 6 });
  add_item("Masters House" ,  { "Experts House": 1, "Rough Logs": 480, "Rough Stone": 48, "Slate Block": 180 } , { tier: 6 });
  add_item("Legendary Explorers Villa", { "Legendary Explorers Residence" : 1, "Rough Logs": 480, "Rough Stone": 48, "Slate Block": 180 }, { tier: 6 });

  add_item("Grandmasters Guild Hall", { "Masters Guild Hall": 1, "Rough Logs": 4800, "Rough Stone": 480, "Basalt Block": 900 }, { tier: 7 });
  add_item("Grandmasters House" ,  { "Masters House": 1, "Rough Logs": 960, "Rough Stone": 96, "Basalt Block": 180 } , { tier: 7 });
  add_item("Legendary Explorers Manor", { "Legendary Explorers Villa" : 1, "Rough Logs": 960, "Rough Stone": 96, "Basalt Block": 180 }, { tier: 7 });

  add_item("Elders Guild Hall", { "Grandmasters Guild Hall": 1, "Rough Logs": 9600, "Rough Stone": 960, "Marble Block": 900 }, { tier: 8 });
  add_item("Elders House" ,  { "Grandmasters House": 1, "Rough Logs": 1920, "Rough Stone": 192, "Marble Block": 180 } , { tier: 8 });
  add_item("Legendary Explorers Palace", { "Legendary Explorers Manor" : 1, "Rough Logs": 1920, "Rough Stone": 192, "Marble Block": 180 }, { tier: 8 });

  /* Craft -> T1 */
  add_item("Workbench", { "Rough Logs" : 25, "Rough Stone" : 100 }, {tier: 1});

  /* Craft -> T2 */
  add_item("Novices Cook",          { "Rough Logs" : 50, "Rough Stone": 5, "Limestone Block" : 300 }, {tier: 2});
  add_item("Novice Warriors Forge", { "Rough Logs" : 50, "Rough Stone": 5, "Limestone Block" : 300 }, {tier: 2});
  add_item("Novice Alchemists Lab", { "Rough Logs" : 50, "Rough Stone": 5, "Limestone Block" : 300 }, {tier: 2});
  add_item("Novices Toolmaker",     { "Rough Logs" : 50, "Rough Stone": 5, "Limestone Block" : 300 }, {tier: 2});
  add_item("Novice Mages Tower",    { "Rough Logs" : 50, "Rough Stone": 5, "Limestone Block" : 300 }, {tier: 2});
  add_item("Novice Hunters Lodge",  { "Rough Logs" : 50, "Rough Stone": 5, "Limestone Block" : 300 }, {tier: 2});

  add_item("Novices Smelter",     { "Rough Logs" : 25 , "Rough Stone" : 3 , "Limestone Block" : 150 }, {tier: 2});
  add_item("Novices Tanner",      { "Rough Logs" : 25 , "Rough Stone" : 3 , "Limestone Block" : 150 }, {tier: 2});
  add_item("Novices Weaver",      { "Rough Logs" : 25 , "Rough Stone" : 3 , "Limestone Block" : 150 }, {tier: 2});
  add_item("Novices Lumbermill",  { "Rough Logs" : 25 , "Rough Stone" : 3 , "Limestone Block" : 150 }, {tier: 2});

  add_item("Novices Stonemason",  { "Rough Logs" : 25 , "Rough Stone" : 25, "Limestone"       : 150 }, {tier: 2});

  /* Craft -> T3 */
  add_item("Journeymans Mill",        { "Rough Logs" : 50, "Rough Stone" : 5, "Sandstone Block" : 150 }, {tier: 3});
  add_item("Journeymans Butcher",     { "Rough Logs" : 50, "Rough Stone" : 5, "Sandstone Block" : 150 }, {tier: 3});

  add_item("Journeymans Saddler",     { "Rough Logs" : 100, "Rough Stone" : 10, "Sandstone Block" : 300 }, {tier: 3});

  add_item("Journeymans Cook",          { "Novices Cook": 1,                "Rough Logs": 100, "Rough Stone": 10, "Sandstone Block": 300 }, {tier: 3});
  add_item("Journeyman Warriors Forge", { "Novice Warriors Forge":      1,  "Rough Logs": 100, "Rough Stone": 10, "Sandstone Block": 300 }, {tier: 3});
  add_item("Journeyman Alchemists Lab", { "Novice Alchemists Lab":      1,  "Rough Logs": 100, "Rough Stone":  10, "Sandstone Block" : 300 }, {tier: 3});
  add_item("Journeymans Toolmaker",     { "Novices Toolmaker":          1,  "Rough Logs": 100, "Rough Stone":  10, "Sandstone Block" : 300 }, {tier: 3});
  add_item("Journeyman Mages Tower",    { "Novice Mages Tower":         1,  "Rough Logs": 100, "Rough Stone":  10, "Sandstone Block" : 300 }, {tier: 3});
  add_item("Journeyman Hunters Lodge",  { "Novice Hunters Lodge":       1,  "Rough Logs": 100, "Rough Stone":  10, "Sandstone Block" : 300 }, {tier: 3});

  add_item("Journeymans Smelter",       { "Novices Smelter":            1,  "Rough Logs": 50, "Rough Stone":  5, "Sandstone Block" : 150 }, {tier: 3});
  add_item("Journeymans Tanner",        { "Novices Tanner":             1,  "Rough Logs": 50, "Rough Stone":  5, "Sandstone Block" : 150 }, {tier: 3});
  add_item("Journeymans Weaver",        { "Novices Weaver":             1,  "Rough Logs": 50, "Rough Stone":  5, "Sandstone Block" : 150 }, {tier: 3});
  add_item("Journeymans Lumbermill",    { "Novices Lumbermill":         1,  "Rough Logs": 50, "Rough Stone":  5, "Sandstone Block" : 150 }, {tier: 3});

  add_item("Journeymans Stonemason",    { "Novices Stonemason":         1, "Rough Logs": 50, "Rough Stone": 50, "Sandstone": 150 }, {tier: 3});

  add_item("Journeymans Transmutator",  { "Rough Logs": 60, "Rough Stone": 6, "Sandstone Block": 180}, { tier: 3 });

  /* Craft -> T4 */

  add_item("Adepts Saddler",       { "Journeymans Saddler" :           1,  "Rough Logs": 200, "Rough Stone":  20, "Travertine Block": 300 }, {tier: 4});
  add_item("Adepts Cook",          { "Journeymans Cook":               1,  "Rough Logs": 200, "Rough Stone":  20, "Travertine Block": 300 }, {tier: 4});
  add_item("Adept Warriors Forge", { "Journeyman Warriors Forge":      1,  "Rough Logs": 200, "Rough Stone":  20, "Travertine Block": 300 }, {tier: 4});
  add_item("Adept Alchemists Lab", { "Journeyman Alchemists Lab":      1,  "Rough Logs": 200, "Rough Stone":  20, "Travertine Block": 300 }, {tier: 4});
  add_item("Adepts Toolmaker",     { "Journeymans Toolmaker":          1,  "Rough Logs": 200, "Rough Stone":  20, "Travertine Block": 300 }, {tier: 4});
  add_item("Adept Mages Tower",    { "Journeyman Mages Tower":         1,  "Rough Logs": 200, "Rough Stone":  20, "Travertine Block": 300 }, {tier: 4});
  add_item("Adept Hunters Lodge",  { "Journeyman Hunters Lodge":       1,  "Rough Logs": 200, "Rough Stone":  20, "Travertine Block": 300 }, {tier: 4});

  add_item("Adepts Butcher",       { "Journeymans Butcher":            1, "Rough Logs" : 100, "Rough Stone" : 10, "Travertine Block" : 150 }, {tier: 4});
  add_item("Adepts Smelter",       { "Journeymans Smelter":            1,  "Rough Logs": 100, "Rough Stone":  10, "Travertine Block" : 150 }, {tier: 4});
  add_item("Adepts Tanner",        { "Journeymans Tanner":             1,  "Rough Logs": 100, "Rough Stone":  10, "Travertine Block" : 150 }, {tier: 4});
  add_item("Adepts Weaver",        { "Journeymans Weaver":             1,  "Rough Logs": 100, "Rough Stone":  10, "Travertine Block" : 150 }, {tier: 4});
  add_item("Adepts Lumbermill",    { "Journeymans Lumbermill":         1,  "Rough Logs": 100, "Rough Stone":  10, "Travertine Block" : 150 }, {tier: 4});

  add_item("Adepts Stonemason",    { "Journeymans Stonemason":         1, "Rough Logs": 100, "Rough Stone": 100, "Travertine": 150 }, {tier: 4});

  add_item("Adepts Transmutator",  { "Journeymans Transmutator":        1, "Rough Logs": 120, "Rough Stone": 12, "Travertine Block": 180}, { tier: 4 });

  /* Craft -> T5 */


  add_item("Experts Saddler",       { "Adepts Saddler" :           1,  "Rough Logs": 400, "Rough Stone":  40, "Granite Block": 300 }, {tier: 5});
  add_item("Experts Cook",          { "Adepts Cook":               1,  "Rough Logs": 400, "Rough Stone":  40, "Granite Block": 300 }, {tier: 5});
  add_item("Expert Warriors Forge", { "Adept Warriors Forge":      1,  "Rough Logs": 400, "Rough Stone":  40, "Granite Block": 300 }, {tier: 5});
  add_item("Expert Alchemists Lab", { "Adept Alchemists Lab":      1,  "Rough Logs": 400, "Rough Stone":  40, "Granite Block": 300 }, {tier: 5});
  add_item("Experts Toolmaker",     { "Adepts Toolmaker":          1,  "Rough Logs": 400, "Rough Stone":  40, "Granite Block": 300 }, {tier: 5});
  add_item("Expert Mages Tower",    { "Adept Mages Tower":         1,  "Rough Logs": 400, "Rough Stone":  40, "Granite Block": 300 }, {tier: 5});
  add_item("Expert Hunters Lodge",  { "Adept Hunters Lodge":       1,  "Rough Logs": 400, "Rough Stone":  40, "Granite Block": 300 }, {tier: 5});

  add_item("Experts Butcher",       { "Adepts Butcher":            1,  "Rough Logs": 200, "Rough Stone":  20, "Granite Block" : 150 }, {tier: 5});
  add_item("Experts Smelter",       { "Adepts Smelter":            1,  "Rough Logs": 200, "Rough Stone":  20, "Granite Block" : 150 }, {tier: 5});
  add_item("Experts Tanner",        { "Adepts Tanner":             1,  "Rough Logs": 200, "Rough Stone":  20, "Granite Block" : 150 }, {tier: 5});
  add_item("Experts Weaver",        { "Adepts Weaver":             1,  "Rough Logs": 200, "Rough Stone":  20, "Granite Block" : 150 }, {tier: 5});
  add_item("Experts Lumbermill",    { "Adepts Lumbermill":         1,  "Rough Logs": 200, "Rough Stone":  20, "Granite Block" : 150 }, {tier: 5});

  add_item("Experts Stonemason",    { "Adepts Stonemason":         1, "Rough Logs": 200, "Rough Stone": 200, "Granite": 150 }, {tier: 5});

  add_item("Experts Transmutator",  { "Adepts Transmutator":        1, "Rough Logs": 240, "Rough Stone": 24, "Granite Block": 180}, {tier: 5});

  add_item("Altar Of Nature", { "Rough Logs": 800, "Rough Stone": 400, "Cedar Planks": 200, "Granite Block": 100 }, {tier: 5});
  add_item("Altar Of Valor" , { "Rough Logs": 400, "Rough Stone": 800, "Cedar Planks": 100, "Granite Block": 200 }, {tier: 5});
  add_item("Altar Of Magic" , { "Rough Logs": 600, "Rough Stone": 600, "Cedar Planks": 150, "Granite Block": 150 }, {tier: 5});

  /* Craft -> T6 */

  add_item("Masters Saddler",       { "Experts Saddler" :           1,  "Rough Logs": 800, "Rough Stone":  80, "Slate Block": 300 }, {tier: 6});
  add_item("Masters Cook",          { "Experts Cook":               1,  "Rough Logs": 800, "Rough Stone":  80, "Slate Block": 300 }, {tier: 6});
  add_item("Master Warriors Forge", { "Expert Warriors Forge":      1,  "Rough Logs": 800, "Rough Stone":  80, "Slate Block": 300 }, {tier: 6});
  add_item("Master Alchemists Lab", { "Expert Alchemists Lab":      1,  "Rough Logs": 800, "Rough Stone":  80, "Slate Block": 300 }, {tier: 6});
  add_item("Masters Toolmaker",     { "Experts Toolmaker":          1,  "Rough Logs": 800, "Rough Stone":  80, "Slate Block": 300 }, {tier: 6});
  add_item("Master Mages Tower",    { "Expert Mages Tower":         1,  "Rough Logs": 800, "Rough Stone":  80, "Slate Block": 300 }, {tier: 6});
  add_item("Master Hunters Lodge",  { "Expert Hunters Lodge":       1,  "Rough Logs": 800, "Rough Stone":  80, "Slate Block": 300 }, {tier: 6});

  add_item("Masters Butcher",       { "Experts Butcher":            1,  "Rough Logs": 400, "Rough Stone":  40, "Slate Block" : 150 }, {tier: 6});
  add_item("Masters Smelter",       { "Experts Smelter":            1,  "Rough Logs": 400, "Rough Stone":  40, "Slate Block" : 150 }, {tier: 6});
  add_item("Masters Tanner",        { "Experts Tanner":             1,  "Rough Logs": 400, "Rough Stone":  40, "Slate Block" : 150 }, {tier: 6});
  add_item("Masters Weaver",        { "Experts Weaver":             1,  "Rough Logs": 400, "Rough Stone":  40, "Slate Block" : 150 }, {tier: 6});
  add_item("Masters Lumbermill",    { "Experts Lumbermill":         1,  "Rough Logs": 400, "Rough Stone":  40, "Slate Block" : 150 }, {tier: 6});

  add_item("Masters Stonemason",    { "Experts Stonemason":         1, "Rough Logs": 400, "Rough Stone": 400, "Slate": 150 }, {tier: 6});

  add_item("Masters Transmutator",  { "Experts Transmutator":        1, "Rough Logs": 480, "Rough Stone": 48, "Slate Block": 180}, {tier: 6});

  add_item("Shrine Of Nature", { "Rough Logs": 1600, "Rough Stone": 800, "Bloodoak Planks": 200, "Slate Block": 100 }, {tier: 6});
  add_item("Shrine Of Valor" , { "Rough Logs":  800, "Rough Stone": 1600, "Bloodoak Planks": 100, "Slate Block": 200 }, {tier: 6});
  add_item("Shrine Of Magic" , { "Rough Logs": 1200, "Rough Stone": 1200, "Bloodoak Planks": 150, "Slate Block": 150 }, {tier: 6});

  /* Craft -> T7 */

  add_item("Grandmasters Saddler",       { "Masters Saddler" :           1,  "Rough Logs": 1600, "Rough Stone":  160, "Basalt Block": 300 }, {tier: 7});
  add_item("Grandmasters Cook",          { "Masters Cook":               1,  "Rough Logs": 1600, "Rough Stone":  160, "Basalt Block": 300 }, {tier: 7});
  add_item("Grandmaster Warriors Forge", { "Master Warriors Forge":      1,  "Rough Logs": 1600, "Rough Stone":  160, "Basalt Block": 300 }, {tier: 7});
  add_item("Grandmaster Alchemists Lab", { "Master Alchemists Lab":      1,  "Rough Logs": 1600, "Rough Stone":  160, "Basalt Block": 300 }, {tier: 7});
  add_item("Grandmasters Toolmaker",     { "Masters Toolmaker":          1,  "Rough Logs": 1600, "Rough Stone":  160, "Basalt Block": 300 }, {tier: 7});
  add_item("Grandmaster Mages Tower",    { "Master Mages Tower":         1,  "Rough Logs": 1600, "Rough Stone":  160, "Basalt Block": 300 }, {tier: 7});
  add_item("Grandmaster Hunters Lodge",  { "Master Hunters Lodge":       1,  "Rough Logs": 1600, "Rough Stone":  160, "Basalt Block": 300 }, {tier: 7});

  add_item("Grandmasters Butcher",       { "Masters Butcher":            1,  "Rough Logs": 800, "Rough Stone":  80, "Basalt Block" : 150 }, {tier: 7});
  add_item("Grandmasters Smelter",       { "Masters Smelter":            1,  "Rough Logs": 800, "Rough Stone":  80, "Basalt Block" : 150 }, {tier: 7});
  add_item("Grandmasters Tanner",        { "Masters Tanner":             1,  "Rough Logs": 800, "Rough Stone":  80, "Basalt Block" : 150 }, {tier: 7});
  add_item("Grandmasters Weaver",        { "Masters Weaver":             1,  "Rough Logs": 800, "Rough Stone":  80, "Basalt Block" : 150 }, {tier: 7});
  add_item("Grandmasters Lumbermill",    { "Masters Lumbermill":         1,  "Rough Logs": 800, "Rough Stone":  80, "Basalt Block" : 150 }, {tier: 7});

  add_item("Grandmasters Stonemason",    { "Masters Stonemason":         1, "Rough Logs": 800, "Rough Stone": 800, "Basalt": 150 }, {tier: 7});

  add_item("Grandmasters Transmutator",  { "Masters Transmutator":        1, "Rough Logs": 960, "Rough Stone": 96, "Basalt Block": 180}, {tier: 7});

  add_item("Temple Of Nature", { "Rough Logs": 3200, "Rough Stone": 1600, "Ashenbark Planks": 200, "Basalt Block": 100 }, {tier: 7}); // Bug in Albion2d? Thinks this is slate
  add_item("Temple Of Valor" , { "Rough Logs": 1600, "Rough Stone": 3200, "Ashenbark Planks": 100, "Basalt Block": 200 }, {tier: 7});
  add_item("Temple Of Magic" , { "Rough Logs": 2400, "Rough Stone": 2400, "Ashenbark Planks": 150, "Basalt Block": 150 }, {tier: 7});

  /* Craft -> T8 */
  add_item("Elders Saddler",       { "Grandmasters Saddler" :           1,  "Rough Logs": 3200, "Rough Stone":  320, "Marble Block": 300 }, {tier: 8});
  add_item("Elders Cook",          { "Grandmasters Cook":               1,  "Rough Logs": 3200, "Rough Stone":  320, "Marble Block": 300 }, {tier: 8});
  add_item("Elder Warriors Forge", { "Grandmaster Warriors Forge":      1,  "Rough Logs": 3200, "Rough Stone":  320, "Marble Block": 300 }, {tier: 8});
  add_item("Elder Alchemists Lab", { "Grandmaster Alchemists Lab":      1,  "Rough Logs": 3200, "Rough Stone":  320, "Marble Block": 300 }, {tier: 8});
  add_item("Elders Toolmaker",     { "Grandmasters Toolmaker":          1,  "Rough Logs": 3200, "Rough Stone":  320, "Marble Block": 300 }, {tier: 8});
  add_item("Elder Mages Tower",    { "Grandmaster Mages Tower":         1,  "Rough Logs": 3200, "Rough Stone":  320, "Marble Block": 300 }, {tier: 8});
  add_item("Elder Hunters Lodge",  { "Grandmaster Hunters Lodge":       1,  "Rough Logs": 3200, "Rough Stone":  320, "Marble Block": 300 }, {tier: 8});

  add_item("Elders Butcher",       { "Grandmasters Butcher":            1,  "Rough Logs": 1600, "Rough Stone":  160, "Marble Block" : 150 }, {tier: 8});
  add_item("Elders Smelter",       { "Grandmasters Smelter":            1,  "Rough Logs": 1600, "Rough Stone":  160, "Marble Block" : 150 }, {tier: 8});
  add_item("Elders Tanner",        { "Grandmasters Tanner":             1,  "Rough Logs": 1600, "Rough Stone":  160, "Marble Block" : 150 }, {tier: 8});
  add_item("Elders Weaver",        { "Grandmasters Weaver":             1,  "Rough Logs": 1600, "Rough Stone":  160, "Marble Block" : 150 }, {tier: 8});
  add_item("Elders Lumbermill",    { "Grandmasters Lumbermill":         1,  "Rough Logs": 1600, "Rough Stone":  160, "Marble Block" : 150 }, {tier: 8});

  add_item("Elders Stonemason",    { "Grandmasters Stonemason":         1, "Rough Logs": 1600, "Rough Stone": 1600, "Marble": 150 }, {tier: 8});

  add_item("Elders Transmutator",  { "Grandmasters Transmutator":        1, "Rough Logs": 1920, "Rough Stone": 192, "Marble Block": 180}, {tier: 8});

  /* Farm */

  add_item("Farm",          { "Rough Logs" : 15, "Rough Stone" : 15 }, {tier: 1});

  add_item("Herb Garden",   { "Rough Logs" : 25, "Rough Stone" : 25, "Birch Planks": 25, "Limestone Block": 25 }, {tier: 2});

  add_item("Pasture",  { "Rough Logs" : 30, "Rough Stone" : 30, "Chestnut Planks": 30, "Sandstone Block": 30 }, {tier: 3});

  add_item("Kennel",   { "Bloodoak Logs" : 50, "Slate" : 50, "Runite Steel Bar" : 10 }, {tier: 6});

  /* Meld */
  add_item("Artifact Foundry", { "Rough Logs": 3200, "Marble Block": 300 }, { tier: 8 });

  /* Repair */
  add_item("Novices Repair Station",  { "Rough Logs"   : 90 , "Rough Stone"     : 90,
                                        "Birch Planks" : 90 , "Limestone Block" : 90  }, {tier: 2});

  add_item("Journeymans Repair Station",  {  "Novices Repair Station": 1,   "Rough Logs"   : 90 , "Rough Stone"     : 90,   "Chestnut Planks" : 90 , "Sandstone Block" : 90  }, {tier: 3});
  add_item("Adepts Repair Station",  {  "Journeymans Repair Station": 1,   "Rough Logs"   : 90 , "Rough Stone"     : 90,   "Pine Planks" : 90 , "Travertine Block" : 90  }, {tier: 4});
  add_item("Experts Repair Station",  {  "Adepts Repair Station": 1,   "Rough Logs"   : 90 , "Rough Stone"     : 90,   "Cedar Planks" : 90 , "Granite Block" : 90  }, {tier: 5});
  add_item("Masters Repair Station",  {  "Experts Repair Station": 1,   "Rough Logs"   : 90 , "Rough Stone"     : 90,   "Bloodoak Planks" : 90 , "Slate Block" : 90  }, {tier: 6});
  add_item("Grandmasters Repair Station",  {  "Masters Repair Station": 1,   "Rough Logs"   : 90 , "Rough Stone"     : 90,   "Ashenbark Planks" : 90 , "Basalt Block" : 90  }, {tier: 7});
  add_item("Elders Repair Station",  {  "Grandmasters Repair Station": 1,   "Rough Logs"   : 90 , "Rough Stone"     : 90,   "Whitewood Planks" : 90 , "Marble Block" : 90  }, {tier: 8});



})();

 </script>
 </head>
 <body>
  <div id="in">
     <label>Item Search:</label><input id="itemfilter" type="text" value="" />
     <label>Item:</label><select id="dd"></select>
     <label>Amount:</label><input id="amt" type="text" value="" />
     <label>Assume Having Everything:</label><input id="workbackwards" type="checkbox" value="" />
  </div>
  <div id="outtotals">
  </div>
  <div id="out">

  </div>
  <div id="halp">
    <h4>Help:</h4>
    <h5>Working Out Resource Counts:</h5>
    <ol>
      <li>Pick an item from the drop down box you need</li>
      <li>Enter how many you need of it in "Amount"</li>
      <li>Breakdown of resources needed is displayed</li>
    </ol>
    <p>Each item displayed contains its nested components, and how many of those components are required
       to craft the indicated number of parent components</p>
    <p>Entering how much you have of a given component in the provided box updates the calculations
       all the way down, and shows you how much you have <em>left</em> to acquire</p>

    <p>So for example, if you picked <strong class="rlevel4">Travertine Block</strong> and indicated you needed <strong>100</strong>,
    the result would indicate you needed <strong class="rlevel4">200 Travertine</strong> and <strong class="rlevel3">100 Sandstone Block</strong>
    to craft <strong class="rlevel4">100 Travertine Block</strong>s</p>

    <p>If you didn't have <strong class="rlevel4">200 Travertine</strong> you could transmute it from <strong class="rlevel3">1200 Sandstone</strong>,
       which could in turn be transmuted from <strong class="rlevel2">3600 Limestone</strong></p>

    <p>If you didn't have <strong class="rlevel3">100 Standsone Block</strong>, you could craft it from <strong class="rlevel3">200 Sandstone</strong>
        and <strong class="rlevel2">100 Limestone Block</strong>( Transmutations are indicated by the yellow glow )</p>

    <p>With some rough mental addition, you could also realise that to build <strong class="rlevel4">100 Travertine Block</strong> exclusively
        from <strong class="rlevel2">Limestone</strong> you'd have to farm <code>3600 + 600 + 100 = </code><strong class="rlevel2">4300 Limestone</strong></p>

    <h5>Finding Items in the Drop Down</h5>
    <p>You can reduce the number of items to hunt through in the drop down if you know what you're looking for.</p>
    <ul>
      <li>A search term that can be found in your items name will show all items containing that term (eg: <em>stone</em>)</li>
      <li>Setting your search term to <code>T3</code> ( or any other Tier, <code>T1</code> to <code>T8</code> ) will
        filter the drop down list to show only items of that Tier</li>
      <li>Combining search terms like <code>T3 Cloth</code> will find all <strong class="rlevel3">Tier 3</strong> items that contain that term, (eg: <strong class="rlevel3">Neat Cloth</strong>)
      <li>Some search terms are special cased, and will match even though they're not in the name. For instance, <code>fibre</code>, <code>stone</code>, <code>food</code> and <code>crop</code> will trim the list down to show those things</li>
    </ul>

    <h5>Keeping the Clutter Down</h5>
    <p>Its worth mentioning that as soon as any resource hits <em>"0 needed"</em>, this tool will automatically hide the child resources.
    This means that if you're trying to spec a building at <strong class="rlevel8">level 8</strong> in advance, it will show a lot of data, which is probably what you want that far ahead.

    However, if you're specing a level 8 when you already have a <strong class="rlevel7">level 7</strong>, it will be easier to read once you state you already have the <strong class="rlevel7">level 7</strong> building.
    </p>
    <p>Alternatively, you can click the <strong>Assume Have Everything</strong> box before entering your initial figure, and it will pre-fill every layer with sufficient
      resources to craft the item above it, and you just have to progressively fix the <em>Have</em> fields that are wrong.</p>

    <h3>Stuff is wrong and broken bruv!</h3>
    <p>Like all software, there will be bugs, and the data might be missing/out of date. Everything you notice as being "out-of-place" is valuable information
       because it will help others with the same problems.</p>
    <p>So, please either tell me personally if something is missing that you were looking for, what you tried to do to find it, etc, or <a href="https://github.com/kentfredric/albion-calc/issues">file a bug on github</a></p>
    <p>If you're a smart cookie, you'll notice the data itself is <a href="https://github.com/kentfredric/albion-calc/blob/master/jsd/items.js"> reasonably well laid out</a> and you might know what it takes to fix it with a <a href="https://github.com/kentfredric/albion-calc/pulls">Pull Request</a></p>
  </div>
  <div><sub>Version: $Id$</sub><br />
       <sub>PS: If github are reading this, sorry, my contact request was wrong, I forgot git ID's
            are <em>document</em> SHA1s not repo commits. I'd have notified you earlier, but your
            contact system doesn't offer a way to follow up on requests before you reply. So I made
            this note instead</sub>
  </div>
  <script>
//<![CDATA[
/* included from jsm/ui.js  */
(function() {
  let dd  = document.getElementById("dd");
  let amt = document.getElementById("amt");
  var out = document.getElementById("out");
  var itemfilter = document.getElementById("itemfilter");
  var workbackwards = document.getElementById("workbackwards");
  let outtotals = document.getElementById("outtotals");

  let AlbionData = document.AlbionData;

  AlbionData.item_names.sort();

  let renderddopts = function(item_names) {
    dd.innerHTML = "";
    for ( let reso_name of item_names ) {
      let opt = document.createElement("option");
      opt.innerHTML = reso_name;

      let reso = AlbionData.get_resource(reso_name);
      if ( reso.has_tier ) {
        opt.className = "rlevel" +  reso.tier;
      }
      dd.appendChild(opt);
    }
  };

  renderddopts(AlbionData.item_names);

  let eat_whitespace = function(term) {
    term = term.replace(/^\s+/, "");
    term = term.replace(/\s+$/, "");
    term = term.replace(/\s+/g, " ");
    return term;
  };

  let calc_bom = undefined;

  let auto_change_input = function() {
    if( marker ) { window.clearTimeout(marker); }
    marker = window.setTimeout(function(){ marker = false;  calc_bom() }, 150);
  };

  let itemFilter_debounce = false;
  itemfilter.addEventListener("keyup", function() {
    if ( itemFilter_debounce ) { window.clearTimeout( itemFilter_debounce ) }
    itemFilter_debounce = window.setTimeout(function() {
      let search = eat_whitespace(itemfilter.value);
      AlbionData.log("Search", search);
      if ( search.length < 1 ) {
        return renderddopts(AlbionData.item_names);
      }
      let res = search.match(/(?:^|\s)T(?:ier|eir|)(?:\s*)([0-8]+)(?:$|\s)/i);
      let out = AlbionData.item_names_copy();

      if ( res != null ){
        AlbionData.log("Teir Search", res[1]);
        out = AlbionData.filter_tier( out, res[1] );
        search = search.replace(/(?:^|\s)T(?:ier|eir|)(?:\s*)(?:[0-8]+)(?:$|\s)/i, "");
        search = eat_whitespace(search);
      }
      if ( search.length > 0 ) {
        /* Fallback search by term */
        AlbionData.log("Generic Search", search);
        for ( let subword of search.split(/\s+/) ) {
          out = AlbionData.filter_keyword( out, subword );
        }
      }
      if ( out.length < 1  ) {
        itemfilter.classList.add("invalid");
        return;
      } else {
        itemfilter.classList.remove("invalid");
        auto_change_input();
      }
      return renderddopts(out);

    }, 150);
  });


  let mkCostModel = function( resource, amt, depth ) {
    if ( typeof amt == "undefined" ) {
      amt = 1;
    }
    if ( typeof depth == "undefined" ) {
      depth = 1;
    }

    let model_data = {
      initial_amt: amt,
      resource: resource,
      have: 0,
      display_needed: amt,
      currently_needed: amt,
      resource_data: AlbionData.get_resource(resource),
      update_fns: [],
      is_transmutation: false,
    };

    if ( workbackwards.checked ) {
      model_data.have = model_data.initial_amt;
    }
    for ( let needed_resource of model_data.resource_data.resource_names ) {
      if ( typeof model_data['children'] == "undefined" ) {
        model_data.children = [];
      }
      let my_needed_resource = needed_resource;
      let chld = mkCostModel(
        needed_resource,
        model_data.resource_data.resources_needed(my_needed_resource, amt ),
        depth + 1
      );
      model_data.children.push( chld );
      model_data.update_fns.push( function() {
        chld.setNeeded(
          model_data.resource_data.resources_needed(my_needed_resource, model_data.display_needed)
        );
      });
    }
    if ( model_data.resource_data.can_transmute ) {
      for ( let needed_resource of model_data.resource_data.transmute_from_names ) {
        if ( typeof model_data['children'] == "undefined" ) {
          model_data.children = [];
        }
        let my_needed_resource = needed_resource;
        let chld = mkCostModel(
          needed_resource,
          model_data.resource_data.resources_needed(my_needed_resource, amt ),
          depth + 1
        );
        chld.is_transmutation = true;
        model_data.children.push( chld );
        model_data.update_fns.push( function() {
          chld.setNeeded(
            model_data.resource_data.resources_needed(my_needed_resource, model_data.display_needed)
          );
        });
      }
    }


    model_data.setNeeded = function( namt ) {
      AlbionData.log("[%s] setNeeded", depth, model_data.resource, namt );
      model_data.currently_needed = Number.parseInt( namt );
      model_data.update();
    };
    model_data.setHave = function( namt ) {
      model_data.have = Number.parseInt( namt );
      AlbionData.log("[%s] setHave", depth, model_data.resource, namt );
      model_data.update();
    };
    model_data.update = function() {
      model_data.display_needed = model_data.currently_needed - model_data.have;
      if ( model_data.display_needed < 1 ) {
        model_data.display_needed = 0;
      }
      for ( let child of model_data.update_fns ) {
        child();
      }
    };
    if ( depth == 1 ) {
      AlbionData.log(model_data);
    }

    return model_data;
  };
  let newTotal = function( ) {
    let me = {
      sequence_id: 0,
      items: { },
      update_hooks: [],
    };

    me.add_item = function ( item ) {
      let uuid = me.sequence_id;
      me.sequence_id++;
      me.items[uuid] = item;
      AlbionData.log("Add item", uuid, item );
      me.on_update();
      return uuid;
    };

    me.remove_item = function ( uuid ) {
      AlbionData.log("Remove item", uuid );
      delete me.items[uuid];
      me.on_update();
    };

    me.update_item = function( uuid, item ) {
      AlbionData.log("Update item", uuid, item );
      me.items[uuid] = item;
      me.on_update();
    };

    me.get_totals = function( ) {
      let totals = {};
      for ( let item_id in me.items ) {
        if ( !me.items.hasOwnProperty(item_id) ) {
          continue;
        }
        for ( let item_name in me.items[item_id] ) {
          if ( !me.items[item_id].hasOwnProperty(item_name) ) {
            continue;
          }
          if( !totals.hasOwnProperty(item_name) ) {
            totals[item_name] = 0;
          }
          totals[item_name] = totals[item_name] + me.items[item_id][item_name];
        }
      }
      for ( let total_name in totals ) {
        if( totals.hasOwnProperty(total_name) && totals[total_name] == 0 ) {
          delete totals[total_name];
        }
      }
      return totals;
    };

    me.on_update = function() {
      let totals = me.get_totals();
      console.log("totals", totals);
      for ( let callback of me.update_hooks ) {
        callback( totals );
      }
    };
    return me;
  };

  let gen_reso_line = function( model, totals, depth ) {
    if ( typeof depth == "undefined" ) {
      depth = 1;
    }

    let xdiv = document.createElement("div");
    xdiv.className = "resource_group resource_" + depth;
    if ( model.resource_data.has_tier  ) {
      xdiv.className = xdiv.className + " rlevel" + model.resource_data.tier;
    }
    if ( model.is_transmutation ) {
      xdiv.classList.add("transmutation");
    }

    let divname = document.createElement("span");
    divname.className = "resoname";
    divname.textContent = model.resource;
    xdiv.appendChild(divname);

    let divcnt = document.createElement("span");
    divcnt.className = "resocount";
    divcnt.textContent = model.initial_amt;
    xdiv.appendChild(divcnt);

    let have_amt_label = document.createElement("label");
    have_amt_label.textContent = "Have"
    have_amt_label.className = "have_label";
    xdiv.appendChild(have_amt_label);

    let have_amt = document.createElement("input");
    have_amt.type = "text"
    have_amt.className = "have_amt";
    xdiv.appendChild( have_amt );

    let include_total_label = document.createElement("label");
    include_total_label.textContent = "Include In Resource Totals"
    include_total_label.className = "include_total_label";
    xdiv.appendChild(include_total_label);

    let include_total = document.createElement("input");
    include_total.type = "checkbox";

    let my_total_id = false;
    let child_nodes = [];
    xdiv.AlbionData = {};

    xdiv.AlbionData.set_checked = function( checked ) {
      if ( checked == include_total.checked ) {
        return;
      }
      if ( checked ) {
        include_total.checked = true;
        xdiv.AlbionData.checked_trigger( true );
      };
      include_total.checked = false;
      xdiv.AlbionData.checked_trigger(false);
    };
    xdiv.AlbionData.set_checked_recursive = function( checked ) {
      xdiv.AlbionData.set_checked( checked );
      for ( let child of child_nodes ) {
            child.AlbionData.set_checked_recursive(false);
      }
    };

    xdiv.AlbionData.checked_trigger = function( checked ) {
      var ticket = {};
      ticket[model.resource] = model.display_needed;

      if ( my_total_id === false ) {
        if ( checked ) {
          my_total_id = totals.add_item(ticket);
          return;
        }
      } else {
        if ( checked ) {
          totals.update_item( my_total_id, ticket );
          return;
        } else {
          AlbionData.log("Unchecked, id: ", my_total_id );
          totals.remove_item(my_total_id);
          my_total_id = false;
        }
      }
    };

    if ( !model.is_transmutation && depth > 1 ) {
      include_total.checked = true;
      var ticket = {};
      ticket[model.resource] = model.initial_amt;
      my_total_id = totals.add_item(ticket);
    } else {
      totals.on_update();
    }

    include_total.className = "include_total";
    xdiv.appendChild(include_total);

    let timeout_debounce = false;
    have_amt.addEventListener("keyup", function() {
      if ( timeout_debounce ) { window.clearTimeout( timeout_debounce ); }
      timeout_debounce = window.setTimeout(function() {
        if ( have_amt.value == "" ) {
          return model.setHave( Number.parseInt( 0 ) );
        }
        let amtv = Number.parseInt( have_amt.value );
        if ( ( "" + amtv ) == "NaN" ) {
          return model.setHave( Number.parseInt( 0 ) );
        }
        model.setHave( amtv );
        if ( my_total_id !== false ) {
          var ticket = {};
          ticket[model.resource] = model.display_needed;
          totals.update_item( my_total_id, ticket );
        }
      }, 150);
    });

    include_total.addEventListener("change", function() {
      xdiv.AlbionData.checked_trigger( include_total.checked );
    });

    let child_node = false;


    if ( typeof model['children'] != "undefined" ) {
      child_node = document.createElement("div");
      child_node.className = "components";
      for( let child of model['children'] ) {
        var inner_child = gen_reso_line( child, totals, depth + 1 );
        child_nodes.push( inner_child );
        child_node.appendChild( inner_child );
      }
      xdiv.appendChild( child_node );
    }
    let autohide = function() {
      divcnt.textContent = model.display_needed;
      if ( model.display_needed < 1 && child_node ) {
        child_node.classList.add("hidden");
        xdiv.AlbionData.set_checked_recursive( false );
      } else if ( child_node ) {
        child_node.classList.remove("hidden");
      }
    };
    model.update_fns.push(autohide);
    if ( depth > 1 ) {
      have_amt.value = model.have;
      model.setHave(have_amt.value);
    } else {
      have_amt.value = 0;
      model.setHave(0);
    }

    return xdiv;
  };

  calc_bom = function() {
    let camt = Number.parseInt(amt.value);
    if ( "" + camt  == "NaN" ) {
      camt = 1;
      amt.value = "1";
    } else if ( ( "" + camt  ) != amt.value ) {
      amt.value = camt;
    }
    out.innerHTML = "";
    if ( camt < 1 ) {
      return;
    }

    let resource = dd.value;
    let resource_mats = AlbionData.get_resources(resource);
    AlbionData.costModel = mkCostModel( resource, camt );
    let totalCosts = newTotal();
    let draw_bounce = false;
    totalCosts.update_hooks.push(function(totals) {
      if ( draw_bounce !== false ) { window.clearTimeout(draw_bounce) }
      draw_bounce = window.setTimeout( function() {
        outtotals.innerHTML = "";
        let header = document.createElement("h2");
        header.textContent = "Totals";
        outtotals.appendChild(header);
        let ul = document.createElement('ul');
        let keys = [];
        for ( let key in totals ) {
          if ( totals.hasOwnProperty( key ) ) {
            keys.push(key);
          }
        }
        keys.sort();
        for ( let key of keys ) {
          if ( totals.hasOwnProperty( key ) ) {
            let resodata = AlbionData.get_resource( key );

            let container = document.createElement("li");
            container.className = "resource_group";
            if ( resodata.has_tier ) {
              container.classList.add("rlevel" + resodata.tier );
            }

            let obj  = document.createElement("span");
            obj.className ="resoname";
            obj.textContent = key;

            container.appendChild(obj);

            let num = document.createElement("span");
            num.className = "resocount";
            num.textContent = totals[key];

            container.appendChild(num);

            ul.appendChild(container);
          }
        }
        outtotals.appendChild(ul);
      }, 150 );
    });
    let header = document.createElement("h2");
    header.textContent = "Breakdown";
    out.appendChild(header);
    out.appendChild(gen_reso_line( AlbionData.costModel, totalCosts, 1 ));
  };
  let marker = false;
  dd.addEventListener("change", auto_change_input);
  dd.addEventListener("mouseup", auto_change_input);
  amt.addEventListener("keyup", auto_change_input);
  workbackwards.addEventListener("change", auto_change_input );
})();

// ]]>
  </script>
 </body>
</html>
